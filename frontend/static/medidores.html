<!doctype html>
<html lang="es" data-page="medidores">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Medidores</title>
  <link rel="stylesheet" href="/css/styles.css?v=21" />
</head>
<body class="page page-medidores">
  <header class="topbar">
    <div class="topbar-left">
      <div class="brand-panel">
        <img class="brand-logo" src="/assets/img/coop-logo.png" alt="Logo cooperativa" />
        <div class="brand-stack">
          <div class="brand-subtitle">Telegestión</div>
        </div>
      </div>
      <a class="topbar-link" href="/home.html">← Inicio</a>
    </div>
    <div class="topbar-right">
      <div class="page-title">Medidores</div>
      <button id="themeToggle" class="icon-button" title="Modo oscuro">
        <span class="icon">☼</span>
      </button>
    </div>
  </header>

  <main class="content">
    <section class="card">
      <div class="form-grid" id="formGrid">
        <!-- Buscador medidor -->
        <label class="field" id="meterField">
          <span>Medidor</span>
          <div class="input-wrap">
            <span class="in-ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
                <path d="M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" stroke="currentColor" stroke-width="1.7"/>
                <path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
              </svg>
            </span>
            <input id="meterInput" type="text" placeholder="Ej: 141825620 o CIR0141825620" />
          </div>
        </label>

<!-- Archivo (B03 masivo) -->
<label class="field" id="massFileField" style="display:none">
  <span>Archivo (Excel)</span>
  <div class="file-input">
    <input id="massFileInput" type="file" accept=".xlsx,.xls" style="display:none" />
    <button type="button" class="btn-secondary" id="massFileBtn">Seleccionar archivo</button>
    <div class="file-name" id="massFileName">Sin archivos seleccionados</div>
  </div>
  <small class="hint">Subí un Excel con una columna de medidores (por defecto: primera columna).</small>
</label>


        <!-- Método -->
        <label class="field">
          <span>Método</span>
          <div class="select-wrap">
            <select id="methodSelect"></select>
          </div>
        </label>

        <!-- Acción (solo B03) -->
        <label class="field" id="orderField" style="display:none;">
          <span>Acción</span>
          <div class="select-wrap">
            <select id="orderSelect">
              <option value="0">Corte (Order 0)</option>
              <option value="1">Reconexión (Order 1)</option>
            </select>
          </div>
        </label>

        <!-- Prioridad -->
        <label class="field" id="priorityField">
          <span>Prioridad</span>
          <div class="select-wrap">
            <select id="prioritySelect">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2" selected>2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
        </label>

        <!-- Botón leer -->
        <div class="leer-wrap">
          <button id="btnLeer" class="btn-leer" type="button">
            <span class="doc-ico" id="btnLeerIcon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
                <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8l-5-6Z" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
                <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
              </svg>
            </span>
            <span id="btnLeerText">Leer</span>
          </button>
        </div>

<!-- Fecha B03 (un solo campo) -->
<label class="field" id="actField" style="display:none;">
  <span>Fecha</span>
  <div class="input-wrap">
    <input id="actInput" type="datetime-local" step="1" />
  </div>
</label>

        <!-- Fechas (se muestran sólo si el método requiere rango) -->
        <label class="field" id="finiField">
          <span>Fecha de inicio</span>
          <div class="input-wrap">
            <input id="finiInput" type="datetime-local" step="1" />
          </div>
        </label>

        <label class="field" id="fendField">
          <span>Fecha de fin</span>
          <div class="input-wrap">
            <input id="fendInput" type="datetime-local" step="1" />
          </div>
        </label>
      </div>

      <div class="msg" id="msg" role="status" aria-live="polite"></div>
    </section>

    <section class="card">
      <div class="results-head">
        <h2 class="results-title">Resultado</h2>
        <div class="results-actions">
          <button id="btnCsv" class="btn-secondary" type="button" disabled>Descargar CSV</button>
          <button id="btnXml" class="btn-secondary" type="button" disabled>Descargar XML</button>
        </div>
      </div>

      <div id="formBox" class="kv-form" style="display:none;"></div>

      <div class="table-wrap">
        <table class="data-table" id="resultTable"></table>
      </div>

      <pre class="raw-box" id="rawBox" style="display:none;"></pre>
    </section>
  </main>

  <script src="/js/theme.js?v=14"></script>
  <script src="/js/medidores.js?v=21"></script>
</body>
</html>